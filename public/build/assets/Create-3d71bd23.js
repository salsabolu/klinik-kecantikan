import{i as N,l as K,r as J,u as W,m as I,G as P,o as l,k as z,w as L,d as t,h as v,f as O,c as d,F as f,E as k,t as c,e as h,g as b,p as y,n as x,v as j,a as Q}from"./app-807f60dc.js";import{_ as G}from"./SimpleLayout-91b6f32c.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";const X={components:{Head:N,Link:K,SimpleLayout:G},props:{patients:Array,services:Array,products:Array,todaysReservations:Array,errors:Object},setup(p){const u=J(!1),n=W({patient_id:"",reservation_id:"",payment_method:"cash",payment_status:"paid",total:0,items:[{type:"",service_id:null,product_id:null,quantity:1,price:0,subtotal:0}]}),o=I(()=>n.patient_id||n.payment_method!=="cash"||n.payment_status!=="paid"||n.items.some(e=>e.service_id||e.product_id||e.quantity!==1||e.price!==0)),M=()=>{n.items.push({type:"",service_id:null,product_id:null,quantity:1,price:0,subtotal:0})},B=e=>{n.items.length>1&&(n.items.splice(e,1),n.total=n.items.reduce((a,i)=>a+(i.subtotal||0),0))},S=e=>{const a=n.items[e];if(a.service_id){const i=p.services.find(m=>m.id==a.service_id);i&&(a.price=i.harga,s(e))}else if(a.product_id){const i=p.products.find(m=>m.id==a.product_id);i&&(a.price=i.harga,s(e))}},C=e=>{const a=n.items[e];a.service_id=null,a.product_id=null,a.price=0,a.subtotal=0},s=e=>{const a=n.items[e];a.subtotal=(a.quantity||0)*(a.price||0),n.total=n.items.reduce((i,m)=>i+(m.subtotal||0),0)},_=I(()=>n.items.reduce((e,a)=>e+(a.quantity||0),0)),r=I(()=>n.items.reduce((e,a)=>e+(a.subtotal||0),0)),U=e=>isNaN(e)||e===null||e===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e),A=e=>e?e.slice(0,5):"",H=()=>{if(n.reservation_id){const e=p.todaysReservations.find(a=>a.id==n.reservation_id);if(e){n.patient_id=e.patient.id,n.items=[];const a={type:"service",service_id:e.service.id,product_id:null,quantity:1,price:e.service.harga,subtotal:e.service.harga};n.items.push(a),n.total=e.service.harga}}},R=()=>{console.log("Submitting form:",n.data());for(let e=0;e<n.items.length;e++){const a=n.items[e];if(!a.service_id&&!a.product_id){alert(`Item ${e+1}: Silakan pilih layanan atau produk`);return}if(!a.quantity||a.quantity<1){alert(`Item ${e+1}: Jumlah harus lebih dari 0`);return}if(!a.price||a.price<0){alert(`Item ${e+1}: Harga tidak boleh kosong atau negatif`);return}if(a.product_id&&a.quantity){const i=g(a,e);if(a.quantity>i){alert(`Item ${e+1}: Jumlah yang diminta (${a.quantity}) melebihi stok yang tersedia (${i})`);return}}}if(!n.patient_id){alert("Silakan pilih pasien");return}console.log("Form data before submission:",n.data()),n.post(route("transactions.store"),{onSuccess:()=>{console.log("Transaction created successfully")},onError:e=>{console.error("Form submission errors:",e)}})},D=()=>{o.value?u.value=!0:window.location.href=route("transactions.index")},E=()=>{o.value?u.value=!0:window.location.href=route("transactions.index")},T=e=>{if(e.product_id){const a=p.products.find(i=>i.id==e.product_id);return a?a.stok:0}return 0},g=(e,a)=>{if(!e.product_id)return 0;const i=p.products.find(w=>w.id==e.product_id);if(!i)return 0;let m=i.stok,q=0;return n.items.forEach((w,F)=>{F!==a&&w.product_id==e.product_id&&w.quantity&&(q+=parseInt(w.quantity))}),Math.max(0,m-q)},V=(e,a)=>{if(e.product_id&&e.quantity){const i=g(e,a);return parseInt(e.quantity)>i}return!1};return{form:n,showCancelModal:u,hasFormData:o,addItem:M,removeItem:B,updatePrice:S,resetItemSelection:C,calculateSubtotal:s,totalQuantity:_,totalPrice:r,formatCurrency:U,formatTime:A,onReservationSelected:H,submit:R,handleBack:D,handleCancel:E,getProductStock:T,getAvailableStock:g,isStockExceeded:V,isStockWarning:(e,a)=>{if(e.product_id&&e.quantity){const i=g(e,a);return parseInt(e.quantity)<=i&&i<=5&&!V(e,a)}return!1},getStockMessage:(e,a)=>{if(!e.product_id)return"";const i=g(e,a),m=T(e);return(parseInt(e.quantity)||0)>i?`Stok tidak mencukupi! Tersedia: ${i} (dari total ${m})`:i<=5?`Perhatian: Stok tersisa ${i} (dari total ${m})`:`Stok tersedia: ${i} (dari total ${m})`}}}},Z={class:"py-12"},$={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},tt={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},et={class:"p-6 text-gray-900"},st={class:"flex justify-between items-center mb-6"},ot=t("h2",{class:"text-2xl font-semibold"},"Transaksi Baru",-1),at=t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),nt={key:0,class:"alert alert-error"},it=t("h4",{class:"font-bold"},"Error:",-1),lt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},rt={class:"lg:col-span-2 space-y-6"},dt={class:"card bg-base-100 shadow"},ct={class:"card-body"},ut=t("h3",{class:"card-title"},"Informasi Transaksi",-1),_t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},mt={class:"form-control"},ht=t("label",{class:"label"},[t("span",{class:"label-text"},"Pasien *")],-1),bt=t("option",{value:""},"Pilih Pasien",-1),pt=["value"],vt={key:0,class:"label"},ft={class:"label-text-alt text-error"},kt={class:"form-control"},yt=t("label",{class:"label"},[t("span",{class:"label-text"},"Reservasi Hari Ini (Opsional)")],-1),gt=t("option",{value:""},"Pilih reservasi hari ini (opsional)",-1),wt=["value"],xt=t("div",{class:"label"},[t("span",{class:"label-text-alt text-gray-500"}," Memilih reservasi akan otomatis mengisi data pasien dan menambahkan layanan ke transaksi ")],-1),St={class:"form-control"},Ct=t("label",{class:"label"},[t("span",{class:"label-text"},"Metode Pembayaran *")],-1),qt=t("option",{value:"cash"},"Tunai",-1),It=t("option",{value:"debit_card"},"Kartu Debit",-1),Mt=t("option",{value:"credit_card"},"Kartu Kredit",-1),Bt=t("option",{value:"transfer"},"Transfer",-1),Tt=[qt,It,Mt,Bt],Vt={key:0,class:"label"},Pt={class:"label-text-alt text-error"},Lt={class:"form-control"},jt=t("label",{class:"label"},[t("span",{class:"label-text"},"Status Pembayaran *")],-1),Ut=t("option",{value:"paid"},"Lunas",-1),At=t("option",{value:"pending"},"Belum Lunas",-1),Ht=t("option",{value:"partially_paid"},"Sebagian Lunas",-1),Rt=t("option",{value:"cancelled"},"Dibatalkan",-1),Dt=[Ut,At,Ht,Rt],Et={key:0,class:"label"},Ft={class:"label-text-alt text-error"},Nt={class:"card bg-base-100 shadow"},Kt={class:"card-body"},Jt={class:"flex justify-between items-center mb-4"},Wt=t("h3",{class:"card-title"},"Item Transaksi",-1),zt=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),Ot={key:0,class:"alert alert-error mb-4"},Qt=t("svg",{class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Gt={class:"space-y-4"},Yt={class:"flex justify-between items-center mb-4"},Xt={class:"font-semibold"},Zt=["onClick"],$t=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),te=[$t],ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},se={class:"form-control"},oe=t("label",{class:"label"},[t("span",{class:"label-text"},"Layanan")],-1),ae=["onUpdate:modelValue","onChange"],ne=t("option",{value:""},"Pilih Layanan",-1),ie=["value"],le={class:"form-control"},re=t("label",{class:"label"},[t("span",{class:"label-text"},"Produk")],-1),de=["onUpdate:modelValue","onChange"],ce=t("option",{value:""},"Pilih Produk",-1),ue=["value"],_e={class:"form-control"},me=t("label",{class:"label"},[t("span",{class:"label-text"},"Jumlah *")],-1),he=["onUpdate:modelValue","onInput"],be={class:"form-control"},pe=t("label",{class:"label"},[t("span",{class:"label-text"},"Harga Satuan")],-1),ve=["onUpdate:modelValue","onInput"],fe={class:"form-control"},ke=t("label",{class:"label"},[t("span",{class:"label-text"},"Subtotal")],-1),ye=["value"],ge={key:0,class:"mt-2"},we={key:0,class:"text-error text-sm"},xe={key:1,class:"text-warning text-sm"},Se={key:2,class:"text-info text-sm"},Ce={class:"space-y-6"},qe={class:"card bg-base-100 shadow"},Ie={class:"card-body"},Me=t("h3",{class:"card-title"},"Ringkasan",-1),Be={class:"space-y-2"},Te={class:"flex justify-between"},Ve=t("span",null,"Total Item:",-1),Pe={class:"font-semibold"},Le=t("div",{class:"divider my-2"},null,-1),je={class:"flex justify-between text-lg font-semibold"},Ue=t("span",null,"Total:",-1),Ae={class:"text-primary"},He={class:"card bg-base-100 shadow"},Re={class:"card-body"},De={class:"flex gap-4"},Ee=["disabled"],Fe={key:0,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ne=t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1),Ke=[Ne],Je={key:1,class:"loading loading-spinner loading-sm mr-2"},We={key:0,class:"modal modal-open"},ze={class:"modal-box"},Oe=t("h3",{class:"font-bold text-lg mb-4"},[t("svg",{class:"w-6 h-6 inline-block mr-2 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})]),v(" Konfirmasi Perubahan ")],-1),Qe=t("p",{class:"py-4 text-base-content/80"}," Anda telah mengisi beberapa data pada form transaksi ini. Jika Anda keluar sekarang, semua data akan hilang. ",-1),Ge=t("p",{class:"text-sm text-base-content/60 mb-6"}," Apakah Anda yakin ingin meninggalkan halaman ini tanpa menyimpan? ",-1),Ye={class:"modal-action"},Xe=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 17l-5-5m0 0l5-5m-5 5h12"})],-1),Ze=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3v1"})],-1);function $e(p,u,n,o,M,B){const S=P("Link"),C=P("SimpleLayout");return l(),z(C,{title:"Transaksi Baru"},{default:L(()=>[t("div",Z,[t("div",$,[t("div",tt,[t("div",et,[t("div",st,[ot,t("button",{onClick:u[0]||(u[0]=(...s)=>o.handleBack&&o.handleBack(...s)),type:"button",class:"btn btn-outline"},[at,v(" Kembali ")])]),t("form",{onSubmit:u[8]||(u[8]=O((...s)=>o.submit&&o.submit(...s),["prevent"])),class:"space-y-6"},[Object.keys(n.errors).length>0?(l(),d("div",nt,[t("div",null,[it,t("ul",null,[(l(!0),d(f,null,k(n.errors,(s,_)=>(l(),d("li",{key:_},[t("strong",null,c(_)+":",1),v(" "+c(s),1)]))),128))])])])):h("",!0),t("div",lt,[t("div",rt,[t("div",dt,[t("div",ct,[ut,t("div",_t,[t("div",mt,[ht,b(t("select",{"onUpdate:modelValue":u[1]||(u[1]=s=>o.form.patient_id=s),class:x(["select select-bordered",{"select-error":n.errors.patient_id}]),required:""},[bt,(l(!0),d(f,null,k(n.patients,s=>(l(),d("option",{key:s.id,value:s.id},c(s.nama_lengkap)+" - "+c(s.nomor_telepon),9,pt))),128))],2),[[y,o.form.patient_id]]),n.errors.patient_id?(l(),d("div",vt,[t("span",ft,c(n.errors.patient_id),1)])):h("",!0)]),t("div",kt,[yt,b(t("select",{"onUpdate:modelValue":u[2]||(u[2]=s=>o.form.reservation_id=s),class:"select select-bordered",onChange:u[3]||(u[3]=(...s)=>o.onReservationSelected&&o.onReservationSelected(...s))},[gt,(l(!0),d(f,null,k(n.todaysReservations,s=>(l(),d("option",{key:s.id,value:s.id},c(s.patient.nama_lengkap)+" - "+c(s.service.nama_layanan)+" ("+c(o.formatTime(s.waktu_mulai))+" - "+c(o.formatTime(s.waktu_selesai))+") - "+c(s.status==="completed"?"Selesai":"Dikonfirmasi"),9,wt))),128))],544),[[y,o.form.reservation_id]]),xt]),t("div",St,[Ct,b(t("select",{"onUpdate:modelValue":u[4]||(u[4]=s=>o.form.payment_method=s),class:x(["select select-bordered",{"select-error":n.errors.payment_method}]),required:""},Tt,2),[[y,o.form.payment_method]]),n.errors.payment_method?(l(),d("div",Vt,[t("span",Pt,c(n.errors.payment_method),1)])):h("",!0)]),t("div",Lt,[jt,b(t("select",{"onUpdate:modelValue":u[5]||(u[5]=s=>o.form.payment_status=s),class:x(["select select-bordered",{"select-error":n.errors.payment_status}]),required:""},Dt,2),[[y,o.form.payment_status]]),n.errors.payment_status?(l(),d("div",Et,[t("span",Ft,c(n.errors.payment_status),1)])):h("",!0)])])])]),t("div",Nt,[t("div",Kt,[t("div",Jt,[Wt,t("button",{onClick:u[6]||(u[6]=(...s)=>o.addItem&&o.addItem(...s)),type:"button",class:"btn btn-sm btn-primary"},[zt,v(" Tambah Item ")])]),n.errors.items?(l(),d("div",Ot,[Qt,t("span",null,c(n.errors.items),1)])):h("",!0),t("div",Gt,[(l(!0),d(f,null,k(o.form.items,(s,_)=>(l(),d("div",{key:_,class:"border border-base-300 rounded-lg p-4"},[t("div",Yt,[t("h4",Xt,"Item "+c(_+1),1),o.form.items.length>1?(l(),d("button",{key:0,onClick:r=>o.removeItem(_),type:"button",class:"btn btn-sm btn-error"},te,8,Zt)):h("",!0)]),t("div",ee,[t("div",se,[oe,b(t("select",{"onUpdate:modelValue":r=>s.service_id=r,onChange:r=>{s.product_id=null,o.updatePrice(_)},class:"select select-bordered select-sm"},[ne,(l(!0),d(f,null,k(n.services,r=>(l(),d("option",{key:r.id,value:r.id},c(r.nama_layanan)+" - "+c(o.formatCurrency(r.harga)),9,ie))),128))],40,ae),[[y,s.service_id]])]),t("div",le,[re,b(t("select",{"onUpdate:modelValue":r=>s.product_id=r,onChange:r=>{s.service_id=null,o.updatePrice(_)},class:"select select-bordered select-sm"},[ce,(l(!0),d(f,null,k(n.products,r=>(l(),d("option",{key:r.id,value:r.id},c(r.nama_produk)+" - "+c(o.formatCurrency(r.harga))+" (Stok: "+c(r.stok)+") ",9,ue))),128))],40,de),[[y,s.product_id]])]),t("div",_e,[me,b(t("input",{"onUpdate:modelValue":r=>s.quantity=r,onInput:r=>o.calculateSubtotal(_),type:"number",min:"1",class:x(["input input-bordered input-sm",{"input-error":o.isStockExceeded(s,_),"input-warning":o.isStockWarning(s,_)}]),placeholder:"Jumlah",required:""},null,42,he),[[j,s.quantity,void 0,{number:!0}]])]),t("div",be,[pe,b(t("input",{"onUpdate:modelValue":r=>s.price=r,onInput:r=>o.calculateSubtotal(_),type:"number",min:"0",class:"input input-bordered input-sm",placeholder:"Harga satuan",readonly:""},null,40,ve),[[j,s.price,void 0,{number:!0}]])]),t("div",fe,[ke,t("input",{value:o.formatCurrency(s.subtotal),type:"text",class:"input input-bordered input-sm",readonly:""},null,8,ye)])]),s.product_id?(l(),d("div",ge,[o.isStockExceeded(s,_)?(l(),d("div",we,c(o.getStockMessage(s,_)),1)):o.isStockWarning(s,_)?(l(),d("div",xe,c(o.getStockMessage(s,_)),1)):(l(),d("div",Se,c(o.getStockMessage(s,_)),1))])):h("",!0)]))),128))])])])]),t("div",Ce,[t("div",qe,[t("div",Ie,[Me,t("div",Be,[t("div",Te,[Ve,t("span",Pe,c(o.totalQuantity),1)]),Le,t("div",je,[Ue,t("span",Ae,c(o.formatCurrency(o.form.total)),1)])])])]),t("div",He,[t("div",Re,[t("div",De,[t("button",{onClick:u[7]||(u[7]=(...s)=>o.handleCancel&&o.handleCancel(...s)),type:"button",class:"btn btn-outline flex-1"}," Batal "),t("button",{type:"submit",disabled:o.form.processing||o.form.items.length===0,class:"btn btn-primary flex-1"},[o.form.processing?h("",!0):(l(),d("svg",Fe,Ke)),o.form.processing?(l(),d("span",Je)):h("",!0),v(" "+c(o.form.processing?"Menyimpan...":"Simpan Transaksi"),1)],8,Ee)])])])])])],32)])])])]),o.showCancelModal?(l(),d("div",We,[t("div",ze,[Oe,Qe,Ge,t("div",Ye,[t("button",{onClick:u[9]||(u[9]=s=>o.showCancelModal=!1),class:"btn btn-ghost"},[Xe,v(" Tetap di Halaman ")]),Q(S,{href:p.route("transactions.index"),class:"btn btn-warning"},{default:L(()=>[Ze,v(" Ya, Keluar ")]),_:1},8,["href"])])])])):h("",!0)]),_:1})}const ns=Y(X,[["render",$e]]);export{ns as default};
