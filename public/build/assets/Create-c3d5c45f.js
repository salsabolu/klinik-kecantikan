import{i as W,l as G,u as J,r as T,m as p,G as j,o,k as X,w as q,D as Y,a as z,d as e,h as _,f as Q,g as x,p as E,n as k,c as l,E as C,t as i,F as D,e as r,v as N}from"./app-807f60dc.js";import{_ as Z}from"./SimpleLayout-91b6f32c.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";const ee={components:{Head:W,Link:G,SimpleLayout:Z},props:{patients:Array,services:Array,doctors:Array,errors:Object},setup(S){console.log("Create reservation component initialized with props:",S);const a=J({patient_id:"",service_id:"",user_id:"",tanggal_reservasi:"",waktu_mulai:"",waktu_selesai:"",catatan:""}),d=T([]),t=T(!1),g=T(null),M=p(()=>S.services.find(n=>n.id==a.service_id)),b=T(!1),f=p(()=>a.patient_id||a.service_id||a.user_id||a.tanggal_reservasi||a.waktu_mulai||a.waktu_selesai||a.catatan),B=p(()=>new Date().toISOString().split("T")[0]),y=()=>{console.log("Service changed, resetting time slots..."),g.value=null,a.waktu_mulai="",a.waktu_selesai="",a.tanggal_reservasi&&a.user_id?(console.log("Date and doctor selected, loading slots..."),s()):console.log("Date or doctor not selected yet")},s=async()=>{var n,v;if(console.log("Loading available slots...",{tanggal_reservasi:a.tanggal_reservasi,user_id:a.user_id,service_id:a.service_id}),!a.tanggal_reservasi||!a.user_id||!a.service_id){d.value=[],console.log("Missing required fields, clearing slots");return}t.value=!0,g.value=null,a.waktu_mulai="",a.waktu_selesai="";try{const u=((n=M.value)==null?void 0:n.durasi_menit)||30,L=I(u,a.tanggal_reservasi);try{const F=(await Y.get("/api/available-slots",{params:{date:a.tanggal_reservasi,doctor_id:a.user_id,service_id:a.service_id},headers:{"X-CSRF-TOKEN":(v=document.querySelector('meta[name="csrf-token"]'))==null?void 0:v.getAttribute("content"),Accept:"application/json","Content-Type":"application/json"},withCredentials:!0})).data.existing_reservations||[],H=L.filter(c=>!F.some(h=>c.waktu_mulai>=h.waktu_mulai&&c.waktu_mulai<h.waktu_selesai||c.waktu_selesai>h.waktu_mulai&&c.waktu_selesai<=h.waktu_selesai||c.waktu_mulai<=h.waktu_mulai&&c.waktu_selesai>=h.waktu_selesai));d.value=H}catch(A){console.log("API call failed, using generated slots without filtering:",A),d.value=L}console.log("Generated available slots:",d.value)}catch(u){console.error("Error in loadAvailableSlots:",u),d.value=[]}finally{t.value=!1}},I=(n,v)=>{const u=[],c=new Date,R=new Date(v).toDateString()===c.toDateString();let P=0;R&&(P=c.getHours()*60+c.getMinutes());const O=30;for(let m=540;m<1080;m+=O){const w=m+n;if(w>1080||m>=720&&m<780||w>720&&w<=780||m<=720&&w>=780||R&&m<=P)continue;const U=V(m),K=V(w);u.push({waktu_mulai:U,waktu_selesai:K,disabled:!1})}return u},V=n=>{const v=Math.floor(n/60),u=n%60;return`${v.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};return{form:a,availableSlots:d,loadingSlots:t,selectedTimeSlot:g,selectedService:M,showCancelModal:b,hasFormData:f,minDate:B,updateServiceInfo:y,loadAvailableSlots:s,selectTimeSlot:n=>{console.log("Selecting time slot:",n),g.value=n,a.waktu_mulai=n.waktu_mulai,a.waktu_selesai=n.waktu_selesai,console.log("Form updated with slot:",{waktu_mulai:a.waktu_mulai,waktu_selesai:a.waktu_selesai})},formatTime:n=>new Date(`2000-01-01 ${n}`).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),formatCurrency:n=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(n),handleCancel:()=>{f.value?b.value=!0:window.location.href=route("reservations.index")},handleBack:()=>{f.value?b.value=!0:window.location.href=route("reservations.index")},submit:()=>{if(console.log("Submitting form with data:",a.data()),!a.patient_id){alert("Silakan pilih pasien");return}if(!a.service_id){alert("Silakan pilih layanan");return}if(!a.tanggal_reservasi){alert("Silakan pilih tanggal");return}if(!a.user_id){alert("Silakan pilih dokter");return}if(!a.waktu_mulai||!a.waktu_selesai){alert("Silakan pilih waktu slot");return}a.post(route("reservations.store"),{onSuccess:()=>{console.log("Reservation created successfully")},onError:n=>{console.error("Form submission errors:",n)}})},processing:p(()=>a.processing),errors:p(()=>a.errors)}}},te={class:"py-12"},ae={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},se={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},oe={class:"p-6 text-gray-900"},le={class:"flex justify-between items-center mb-6"},ne=e("h2",{class:"text-2xl font-semibold"},"Reservasi Baru",-1),ie=e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},de={class:"form-control"},ce=e("label",{class:"label"},[e("span",{class:"label-text"},[_("Pasien "),e("span",{class:"text-red-500"},"*")])],-1),_e=e("option",{value:""},"Pilih Pasien",-1),ue=["value"],me={key:0,class:"label"},he={class:"label-text-alt text-red-500"},ve={class:"form-control"},ke=e("label",{class:"label"},[e("span",{class:"label-text"},[_("Layanan "),e("span",{class:"text-red-500"},"*")])],-1),ge=e("option",{value:""},"Pilih Layanan",-1),be=["value"],fe={key:0,class:"label"},we={class:"label-text-alt text-red-500"},pe={key:1,class:"alert alert-info mt-2"},xe=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Se={class:"font-bold"},ye={class:"text-xs"},Te={class:"text-xs mt-1"},Ce={class:"form-control"},De=e("label",{class:"label"},[e("span",{class:"label-text"},[_("Tanggal Reservasi "),e("span",{class:"text-red-500"},"*")])],-1),Me=["min"],Be={key:0,class:"label"},Le={class:"label-text-alt text-red-500"},Ae={class:"form-control"},je=e("label",{class:"label"},[e("span",{class:"label-text"},[_("Dokter/Terapis "),e("span",{class:"text-red-500"},"*")])],-1),Ee=e("option",{value:""},"Pilih Dokter/Terapis",-1),Ie=["value"],Ve={key:0,class:"label"},Fe={class:"label-text-alt text-red-500"},He={key:0,class:"form-control"},Re=e("label",{class:"label"},[e("span",{class:"label-text"},[_("Waktu Tersedia "),e("span",{class:"text-red-500"},"*")])],-1),Pe={key:0,class:"flex justify-center py-4"},qe=e("span",{class:"loading loading-spinner loading-md"},null,-1),ze=[qe],Ne={key:1,class:"grid grid-cols-3 md:grid-cols-6 gap-2"},Oe=["onClick","disabled"],Ue={key:2,class:"alert alert-warning"},Ke=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1),We=e("span",null,"Tidak ada slot waktu tersedia untuk tanggal dan dokter yang dipilih.",-1),Ge=[Ke,We],Je={key:3,class:"label"},Xe={class:"label-text-alt text-red-500"},Ye={key:1,class:"alert alert-success"},Qe=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Ze=e("h3",{class:"font-bold"},"Waktu Terpilih",-1),$e={class:"text-xs"},et={class:"form-control"},tt={class:"label"},at=e("span",{class:"label-text"},"Catatan (Opsional)",-1),st={class:"label-text-alt"},ot={key:0,class:"label"},lt=e("span",{class:"label-text-alt text-red-500"},"Catatan tidak boleh lebih dari 500 karakter",-1),nt=[lt],it={class:"flex justify-end space-x-4"},rt=["disabled"],dt={key:0,class:"loading loading-spinner loading-sm"},ct={key:0,class:"modal modal-open"},_t={class:"modal-box"},ut=e("h3",{class:"font-bold text-lg mb-4"},[e("svg",{class:"w-6 h-6 inline-block mr-2 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})]),_(" Konfirmasi Perubahan ")],-1),mt=e("p",{class:"py-4 text-base-content/80"}," Anda telah mengisi beberapa data pada form reservasi ini. Jika Anda keluar sekarang, semua data akan hilang. ",-1),ht=e("p",{class:"text-sm text-base-content/60 mb-6"}," Apakah Anda yakin ingin meninggalkan halaman ini tanpa menyimpan? ",-1),vt={class:"modal-action"},kt=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 17l-5-5m0 0l5-5m-5 5h12"})],-1),gt=e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013 3v1"})],-1);function bt(S,a,d,t,g,M){const b=j("Head"),f=j("Link"),B=j("SimpleLayout");return o(),X(B,null,{default:q(()=>{var y;return[z(b,{title:"Reservasi Baru"}),e("div",te,[e("div",ae,[e("div",se,[e("div",oe,[e("div",le,[ne,e("button",{onClick:a[0]||(a[0]=(...s)=>t.handleBack&&t.handleBack(...s)),type:"button",class:"btn btn-outline"},[ie,_(" Kembali ")])]),e("form",{onSubmit:a[10]||(a[10]=Q((...s)=>t.submit&&t.submit(...s),["prevent"])),class:"space-y-6"},[e("div",re,[e("div",de,[ce,x(e("select",{"onUpdate:modelValue":a[1]||(a[1]=s=>t.form.patient_id=s),class:k(["select select-bordered",{"select-error":t.errors.patient_id}]),required:""},[_e,(o(!0),l(D,null,C(d.patients,s=>(o(),l("option",{key:s.id,value:s.id},i(s.nama_lengkap)+" - "+i(s.nomor_telepon),9,ue))),128))],2),[[E,t.form.patient_id]]),t.errors.patient_id?(o(),l("div",me,[e("span",he,i(t.errors.patient_id),1)])):r("",!0)]),e("div",ve,[ke,x(e("select",{"onUpdate:modelValue":a[2]||(a[2]=s=>t.form.service_id=s),class:k(["select select-bordered",{"select-error":t.errors.service_id}]),onChange:a[3]||(a[3]=(...s)=>t.updateServiceInfo&&t.updateServiceInfo(...s)),required:""},[ge,(o(!0),l(D,null,C(d.services,s=>(o(),l("option",{key:s.id,value:s.id},i(s.nama_layanan)+" - "+i(t.formatCurrency(s.harga)),9,be))),128))],34),[[E,t.form.service_id]]),t.errors.service_id?(o(),l("div",fe,[e("span",we,i(t.errors.service_id),1)])):r("",!0),t.selectedService?(o(),l("div",pe,[e("div",null,[xe,e("div",null,[e("h3",Se,i(t.selectedService.nama_layanan),1),e("div",ye," Durasi: "+i(t.selectedService.durasi_menit)+" menit | Harga: "+i(t.formatCurrency(t.selectedService.harga)),1),e("p",Te,i(t.selectedService.deskripsi),1)])])])):r("",!0)]),e("div",Ce,[De,x(e("input",{type:"date","onUpdate:modelValue":a[4]||(a[4]=s=>t.form.tanggal_reservasi=s),class:k(["input input-bordered",{"input-error":t.errors.tanggal_reservasi}]),min:t.minDate,onChange:a[5]||(a[5]=(...s)=>t.loadAvailableSlots&&t.loadAvailableSlots(...s)),required:""},null,42,Me),[[N,t.form.tanggal_reservasi]]),t.errors.tanggal_reservasi?(o(),l("div",Be,[e("span",Le,i(t.errors.tanggal_reservasi),1)])):r("",!0)]),e("div",Ae,[je,x(e("select",{"onUpdate:modelValue":a[6]||(a[6]=s=>t.form.user_id=s),class:k(["select select-bordered",{"select-error":t.errors.user_id}]),onChange:a[7]||(a[7]=(...s)=>t.loadAvailableSlots&&t.loadAvailableSlots(...s)),required:""},[Ee,(o(!0),l(D,null,C(d.doctors,s=>(o(),l("option",{key:s.id,value:s.id},i(s.name),9,Ie))),128))],34),[[E,t.form.user_id]]),t.errors.user_id?(o(),l("div",Ve,[e("span",Fe,i(t.errors.user_id),1)])):r("",!0)])]),t.form.tanggal_reservasi&&t.form.user_id&&t.form.service_id?(o(),l("div",He,[Re,t.loadingSlots?(o(),l("div",Pe,ze)):t.availableSlots.length>0?(o(),l("div",Ne,[(o(!0),l(D,null,C(t.availableSlots,s=>(o(),l("button",{key:s.waktu_mulai,type:"button",onClick:I=>s.disabled?null:t.selectTimeSlot(s),disabled:s.disabled,class:k(["btn btn-sm",{"btn-primary":t.selectedTimeSlot&&t.selectedTimeSlot.waktu_mulai===s.waktu_mulai,"btn-outline":!t.selectedTimeSlot||t.selectedTimeSlot.waktu_mulai!==s.waktu_mulai,"btn-disabled":s.disabled,"opacity-50 cursor-not-allowed":s.disabled}])},i(t.formatTime(s.waktu_mulai)),11,Oe))),128))])):(o(),l("div",Ue,Ge)),t.errors.waktu_mulai?(o(),l("div",Je,[e("span",Xe,i(t.errors.waktu_mulai),1)])):r("",!0)])):r("",!0),t.selectedTimeSlot?(o(),l("div",Ye,[Qe,e("div",null,[Ze,e("div",$e,i(t.formatTime(t.selectedTimeSlot.waktu_mulai))+" - "+i(t.formatTime(t.selectedTimeSlot.waktu_selesai))+" ("+i((y=t.selectedService)==null?void 0:y.durasi_menit)+" menit) ",1)])])):r("",!0),e("div",et,[e("label",tt,[at,e("span",st,i((t.form.catatan||"").length)+"/500",1)]),x(e("textarea",{"onUpdate:modelValue":a[8]||(a[8]=s=>t.form.catatan=s),class:k(["textarea textarea-bordered h-24",{"textarea-error":(t.form.catatan||"").length>500}]),placeholder:"Catatan tambahan untuk reservasi...",maxlength:"500"},null,2),[[N,t.form.catatan]]),(t.form.catatan||"").length>500?(o(),l("div",ot,nt)):r("",!0)]),e("div",it,[e("button",{onClick:a[9]||(a[9]=(...s)=>t.handleCancel&&t.handleCancel(...s)),type:"button",class:"btn btn-outline"}," Batal "),e("button",{type:"submit",class:"btn btn-primary",disabled:t.processing||!t.selectedTimeSlot},[t.processing?(o(),l("span",dt)):r("",!0),_(" "+i(t.processing?"Menyimpan...":"Simpan Reservasi"),1)],8,rt)])],32)])])])]),t.showCancelModal?(o(),l("div",ct,[e("div",_t,[ut,mt,ht,e("div",vt,[e("button",{onClick:a[11]||(a[11]=s=>t.showCancelModal=!1),class:"btn btn-ghost"},[kt,_(" Tetap di Halaman ")]),z(f,{href:S.route("reservations.index"),class:"btn btn-warning"},{default:q(()=>[gt,_(" Ya, Keluar ")]),_:1},8,["href"])])])])):r("",!0)]}),_:1})}const Bt=$(ee,[["render",bt]]);export{Bt as default};
