import{i as q,l as U,r as M,u as F,B as N,m as L,G as P,o as r,c as d,a as x,w as V,F as v,d as t,t as _,h as p,f as E,E as y,e as h,g as b,p as k,n as C,v as A}from"./app-807f60dc.js";import{_ as J}from"./SimpleLayout-91b6f32c.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";const H={components:{Head:q,Link:U,SimpleLayout:J},props:{transaction:Object,patients:Array,services:Array,products:Array,errors:Object},setup(u){const n=M(!1),l=M(!1),e=M({}),c=F({patient_id:u.transaction.patient_id||"",tanggal_transaksi:u.transaction.tanggal_transaksi?new Date(u.transaction.tanggal_transaksi).toISOString().split("T")[0]:"",payment_method:u.transaction.payment_method||"cash",payment_status:u.transaction.payment_status||"paid",items:u.transaction.transaction_details&&u.transaction.transaction_details.length>0?u.transaction.transaction_details.map(a=>({service_id:a.service_id||null,product_id:a.product_id||null,quantity:a.quantity||1,price:parseFloat(a.unit_price)||0,subtotal:parseFloat(a.total_price)||0})):[{service_id:null,product_id:null,quantity:1,price:0,subtotal:0}]});N(()=>{e.value=JSON.parse(JSON.stringify(c.data()))});const g=L(()=>JSON.stringify(c.data())!==JSON.stringify(e.value)),I=L(()=>!c.items||!Array.isArray(c.items)?0:c.items.reduce((a,i)=>a+(parseInt(i.quantity)||0),0)),w=L(()=>!c.items||!Array.isArray(c.items)?0:c.items.reduce((a,i)=>a+(parseFloat(i.subtotal)||0),0)),B=a=>isNaN(a)||a===null||a===void 0?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),s=()=>{c.items.push({service_id:null,product_id:null,quantity:1,price:0,subtotal:0})},m=a=>{c.items.length>1&&c.items.splice(a,1)},o=a=>{const i=c.items[a];i.service_id=null,i.product_id=null,i.price=0,i.subtotal=0},j=a=>{const i=c.items[a];if(i.service_id){const f=u.services.find(T=>T.id==i.service_id);f&&(i.price=parseFloat(f.harga),S(a))}else if(i.product_id){const f=u.products.find(T=>T.id==i.product_id);f&&(i.price=parseFloat(f.harga),S(a))}},S=a=>{const i=c.items[a];i.subtotal=parseFloat((i.quantity||0)*(i.price||0))};return{form:c,showBackModal:n,showCancelModal:l,hasFormData:g,totalQuantity:I,totalPrice:w,formatCurrency:B,addItem:s,removeItem:m,resetItemSelection:o,updatePrice:j,calculateSubtotal:S,handleBack:()=>{g.value?n.value=!0:window.location.href=route("transactions.index")},handleCancel:()=>{g.value?l.value=!0:window.location.href=route("transactions.show",u.transaction.id)},submit:()=>{for(let a=0;a<c.items.length;a++){const i=c.items[a];if(!i.service_id&&!i.product_id){alert(`Item ${a+1}: Pilih layanan atau produk`);return}if(!i.quantity||i.quantity<1){alert(`Item ${a+1}: Jumlah harus diisi dan minimal 1`);return}}if(!c.patient_id){alert("Pilih pasien terlebih dahulu");return}console.log("Form data before submission:",c.data()),c.put(route("transactions.update",u.transaction.id),{onSuccess:()=>{console.log("Transaction updated successfully")},onError:a=>{console.error("Update failed:",a)}})}}}},K={class:"py-12"},O={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},z={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Q={class:"p-6 text-gray-900"},R={class:"flex justify-between items-center mb-6"},Y={class:"text-2xl font-semibold"},G=t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),W={key:0,class:"alert alert-error"},X=t("h4",{class:"font-bold"},"Error:",-1),Z={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},$={class:"lg:col-span-2 space-y-6"},tt={class:"card bg-base-100 shadow"},et={class:"card-body"},st=t("h3",{class:"card-title"},"Informasi Transaksi",-1),at={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nt={class:"form-control"},ot=t("label",{class:"label"},[t("span",{class:"label-text"},"Pasien *")],-1),lt=t("option",{value:""},"Pilih Pasien",-1),it=["value"],rt={key:0,class:"label"},dt={class:"label-text-alt text-error"},ct={class:"form-control"},_t=t("label",{class:"label"},[t("span",{class:"label-text"},"Tanggal Transaksi *")],-1),ut={key:0,class:"label"},mt={class:"label-text-alt text-error"},ht={class:"form-control"},bt=t("label",{class:"label"},[t("span",{class:"label-text"},"Metode Pembayaran *")],-1),pt=t("option",{value:"cash"},"Tunai",-1),vt=t("option",{value:"debit_card"},"Kartu Debit",-1),ft=t("option",{value:"credit_card"},"Kartu Kredit",-1),yt=t("option",{value:"transfer"},"Transfer",-1),kt=[pt,vt,ft,yt],gt={key:0,class:"label"},wt={class:"label-text-alt text-error"},xt={class:"form-control"},Ct=t("label",{class:"label"},[t("span",{class:"label-text"},"Status Pembayaran *")],-1),It=t("option",{value:"paid"},"Lunas",-1),Bt=t("option",{value:"pending"},"Belum Lunas",-1),St=t("option",{value:"partially_paid"},"Sebagian Lunas",-1),Tt=t("option",{value:"cancelled"},"Dibatalkan",-1),Mt=[It,Bt,St,Tt],Lt={key:0,class:"label"},Pt={class:"label-text-alt text-error"},Vt={class:"card bg-base-100 shadow"},At={class:"card-body"},jt={class:"flex justify-between items-center mb-4"},qt=t("h3",{class:"card-title"},"Item Transaksi",-1),Ut=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),Ft={key:0,class:"alert alert-error mb-4"},Nt=t("svg",{class:"stroke-current shrink-0 w-6 h-6",fill:"none",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Et={key:1,class:"space-y-4"},Jt={class:"flex justify-between items-center mb-4"},Dt={class:"font-semibold"},Ht=["onClick"],Kt=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),Ot=[Kt],zt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Qt={class:"form-control"},Rt=t("label",{class:"label"},[t("span",{class:"label-text"},"Layanan")],-1),Yt=["onUpdate:modelValue","onChange"],Gt=t("option",{value:""},"Pilih Layanan",-1),Wt=["value"],Xt={class:"form-control"},Zt=t("label",{class:"label"},[t("span",{class:"label-text"},"Produk")],-1),$t=["onUpdate:modelValue","onChange"],te=t("option",{value:""},"Pilih Produk",-1),ee=["value"],se={class:"form-control"},ae=t("label",{class:"label"},[t("span",{class:"label-text"},"Jumlah *")],-1),ne=["onUpdate:modelValue","onInput"],oe={class:"form-control"},le=t("label",{class:"label"},[t("span",{class:"label-text"},"Harga Satuan")],-1),ie=["onUpdate:modelValue","onInput"],re={class:"form-control"},de=t("label",{class:"label"},[t("span",{class:"label-text"},"Subtotal")],-1),ce=["value"],_e={key:2,class:"text-center py-8 text-gray-500"},ue=t("p",null,"Belum ada item transaksi",-1),me={class:"lg:col-span-1 space-y-6"},he={class:"card bg-base-100 shadow sticky top-4"},be={class:"card-body"},pe=t("h3",{class:"card-title"},"Ringkasan",-1),ve={class:"space-y-2"},fe={class:"flex justify-between"},ye=t("span",null,"Jumlah Item:",-1),ke={class:"flex justify-between"},ge=t("span",null,"Total Qty:",-1),we=t("div",{class:"divider my-2"},null,-1),xe={class:"flex justify-between text-lg font-semibold"},Ce=t("span",null,"Total Harga:",-1),Ie={class:"card bg-base-100 shadow"},Be={class:"card-body"},Se=["disabled"],Te={key:0,class:"loading loading-spinner"},Me=["disabled"],Le={key:0,class:"modal modal-open"},Pe={class:"modal-box"},Ve=t("h3",{class:"font-bold text-lg mb-4"},[t("svg",{class:"w-6 h-6 inline-block mr-2 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})]),p(" Konfirmasi Kembali ")],-1),Ae=t("p",{class:"py-4 text-base-content/80"}," Anda telah melakukan beberapa perubahan pada form transaksi ini. Jika Anda keluar sekarang, perubahan tidak akan tersimpan. ",-1),je=t("p",{class:"text-sm text-base-content/60 mb-6"}," Apakah Anda yakin ingin kembali tanpa menyimpan perubahan? ",-1),qe={class:"modal-action"},Ue={key:1,class:"modal modal-open"},Fe={class:"modal-box"},Ne=t("h3",{class:"font-bold text-lg mb-4"},[t("svg",{class:"w-6 h-6 inline-block mr-2 text-warning",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})]),p(" Konfirmasi Batal ")],-1),Ee=t("p",{class:"py-4 text-base-content/80"}," Anda telah melakukan beberapa perubahan pada form transaksi ini. Jika Anda membatalkan sekarang, perubahan tidak akan tersimpan. ",-1),Je=t("p",{class:"text-sm text-base-content/60 mb-6"}," Apakah Anda yakin ingin membatalkan tanpa menyimpan perubahan? ",-1),De={class:"modal-action"};function He(u,n,l,e,c,g){const I=P("Head"),w=P("Link"),B=P("SimpleLayout");return r(),d(v,null,[x(I,{title:"Edit Transaksi"}),x(B,{title:"Edit Transaksi"},{default:V(()=>[t("div",K,[t("div",O,[t("div",z,[t("div",Q,[t("div",R,[t("h2",Y,"Edit Transaksi #"+_(l.transaction.id),1),t("button",{onClick:n[0]||(n[0]=(...s)=>e.handleBack&&e.handleBack(...s)),type:"button",class:"btn btn-outline"},[G,p(" Kembali ")])]),t("form",{onSubmit:n[8]||(n[8]=E((...s)=>e.submit&&e.submit(...s),["prevent"])),class:"space-y-6"},[Object.keys(l.errors).length>0?(r(),d("div",W,[t("div",null,[X,t("ul",null,[(r(!0),d(v,null,y(l.errors,(s,m)=>(r(),d("li",{key:m},[t("strong",null,_(m)+":",1),p(" "+_(s),1)]))),128))])])])):h("",!0),t("div",Z,[t("div",$,[t("div",tt,[t("div",et,[st,t("div",at,[t("div",nt,[ot,b(t("select",{"onUpdate:modelValue":n[1]||(n[1]=s=>e.form.patient_id=s),class:C(["select select-bordered",{"select-error":l.errors.patient_id}]),required:""},[lt,(r(!0),d(v,null,y(l.patients,s=>(r(),d("option",{key:s.id,value:s.id},_(s.nama_lengkap)+" - "+_(s.nomor_telepon),9,it))),128))],2),[[k,e.form.patient_id]]),l.errors.patient_id?(r(),d("div",rt,[t("span",dt,_(l.errors.patient_id),1)])):h("",!0)]),t("div",ct,[_t,b(t("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>e.form.tanggal_transaksi=s),type:"date",class:C(["input input-bordered",{"input-error":l.errors.tanggal_transaksi}]),required:""},null,2),[[A,e.form.tanggal_transaksi]]),l.errors.tanggal_transaksi?(r(),d("div",ut,[t("span",mt,_(l.errors.tanggal_transaksi),1)])):h("",!0)]),t("div",ht,[bt,b(t("select",{"onUpdate:modelValue":n[3]||(n[3]=s=>e.form.payment_method=s),class:C(["select select-bordered",{"select-error":l.errors.payment_method}]),required:""},kt,2),[[k,e.form.payment_method]]),l.errors.payment_method?(r(),d("div",gt,[t("span",wt,_(l.errors.payment_method),1)])):h("",!0)]),t("div",xt,[Ct,b(t("select",{"onUpdate:modelValue":n[4]||(n[4]=s=>e.form.payment_status=s),class:C(["select select-bordered",{"select-error":l.errors.payment_status}]),required:""},Mt,2),[[k,e.form.payment_status]]),l.errors.payment_status?(r(),d("div",Lt,[t("span",Pt,_(l.errors.payment_status),1)])):h("",!0)])])])]),t("div",Vt,[t("div",At,[t("div",jt,[qt,t("button",{onClick:n[5]||(n[5]=(...s)=>e.addItem&&e.addItem(...s)),type:"button",class:"btn btn-sm btn-primary"},[Ut,p(" Tambah Item ")])]),l.errors.items?(r(),d("div",Ft,[Nt,t("span",null,_(l.errors.items),1)])):h("",!0),e.form.items&&e.form.items.length>0?(r(),d("div",Et,[(r(!0),d(v,null,y(e.form.items,(s,m)=>(r(),d("div",{key:m,class:"border border-base-300 rounded-lg p-4"},[t("div",Jt,[t("h4",Dt,"Item "+_(m+1),1),e.form.items.length>1?(r(),d("button",{key:0,onClick:o=>e.removeItem(m),type:"button",class:"btn btn-sm btn-error"},Ot,8,Ht)):h("",!0)]),t("div",zt,[t("div",Qt,[Rt,b(t("select",{"onUpdate:modelValue":o=>s.service_id=o,onChange:o=>{s.product_id=null,e.updatePrice(m)},class:"select select-bordered select-sm"},[Gt,(r(!0),d(v,null,y(l.services,o=>(r(),d("option",{key:o.id,value:o.id},_(o.nama_layanan)+" - "+_(e.formatCurrency(o.harga)),9,Wt))),128))],40,Yt),[[k,s.service_id]])]),t("div",Xt,[Zt,b(t("select",{"onUpdate:modelValue":o=>s.product_id=o,onChange:o=>{s.service_id=null,e.updatePrice(m)},class:"select select-bordered select-sm"},[te,(r(!0),d(v,null,y(l.products,o=>(r(),d("option",{key:o.id,value:o.id},_(o.nama_produk)+" - "+_(e.formatCurrency(o.harga))+" (Stok: "+_(o.stok)+") ",9,ee))),128))],40,$t),[[k,s.product_id]])]),t("div",se,[ae,b(t("input",{"onUpdate:modelValue":o=>s.quantity=o,onInput:o=>e.calculateSubtotal(m),type:"number",min:"1",class:"input input-bordered input-sm",placeholder:"Jumlah",required:""},null,40,ne),[[A,s.quantity,void 0,{number:!0}]])]),t("div",oe,[le,b(t("input",{"onUpdate:modelValue":o=>s.price=o,onInput:o=>e.calculateSubtotal(m),type:"number",min:"0",class:"input input-bordered input-sm",placeholder:"Harga satuan",readonly:""},null,40,ie),[[A,s.price,void 0,{number:!0}]])]),t("div",re,[de,t("input",{value:e.formatCurrency(s.subtotal),type:"text",class:"input input-bordered input-sm",readonly:""},null,8,ce)])])]))),128))])):(r(),d("div",_e,[ue,t("button",{type:"button",onClick:n[6]||(n[6]=(...s)=>e.addItem&&e.addItem(...s)),class:"btn btn-primary btn-sm mt-2"}," Tambah Item Pertama ")]))])])]),t("div",me,[t("div",he,[t("div",be,[pe,t("div",ve,[t("div",fe,[ye,t("span",null,_(e.form.items?e.form.items.length:0),1)]),t("div",ke,[ge,t("span",null,_(e.totalQuantity),1)]),we,t("div",xe,[Ce,t("span",null,_(e.formatCurrency(e.totalPrice)),1)])])])]),t("div",Ie,[t("div",Be,[t("button",{type:"submit",class:"btn btn-primary w-full",disabled:e.form.processing||e.form.items&&e.form.items.length===0},[e.form.processing?(r(),d("span",Te)):h("",!0),p(" "+_(e.form.processing?"Menyimpan...":"Update Transaksi"),1)],8,Se),t("button",{type:"button",onClick:n[7]||(n[7]=(...s)=>e.handleCancel&&e.handleCancel(...s)),class:"btn btn-outline w-full mt-3",disabled:e.form.processing}," Batal ",8,Me)])])])])],32)])])])]),e.showBackModal?(r(),d("div",Le,[t("div",Pe,[Ve,Ae,je,t("div",qe,[t("button",{onClick:n[9]||(n[9]=s=>e.showBackModal=!1),class:"btn btn-outline"},"Tetap Edit"),x(w,{href:u.route("transactions.index"),class:"btn btn-error"},{default:V(()=>[p("Ya, Kembali")]),_:1},8,["href"])])])])):h("",!0),e.showCancelModal?(r(),d("div",Ue,[t("div",Fe,[Ne,Ee,Je,t("div",De,[t("button",{onClick:n[10]||(n[10]=s=>e.showCancelModal=!1),class:"btn btn-outline"},"Tetap Edit"),x(w,{href:u.route("transactions.show",l.transaction.id),class:"btn btn-error"},{default:V(()=>[p("Ya, Batal")]),_:1},8,["href"])])])])):h("",!0)]),_:1})],64)}const Ge=D(H,[["render",He]]);export{Ge as default};
